---
title: "StreamTemp Cleaning"
author: "Leslie Jones"
date: "January 9, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(dplyr)
library(lubridate)

###Install StreamThermal package in R

#install.packages("devtools")

library(devtools)

#install_github('tsangyp/StreamThermal')

library(StreamThermal)

```

# Wrangling Temperature Data

##Kenai Watershed- Import sites from KNB
Funny River
```{r load data}
Funny <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:68e75d93-a17a-4bc1-9491-839fa5f62df2", method = "libcurl"),stringsAsFactors = FALSE)
Funny$siteID <- "CIK23"
Funny$AKOATS_ID <- NULL
Funny$UseData <- NULL
Funny$Freq <- 96
head(Funny, 10)

Funny$Date = Funny$sampleDate
Funny <- Funny%>% separate(col="Date", into=c("year", "month", "day"))
unique(Funny$year)
head(Funny, 10)
#View (Funny)

```

Hidden Creek
```{r load data}
Hidden <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:4856b605-a491-4845-920f-2defa803e5c6", method = "libcurl"),
                    stringsAsFactors = FALSE)
Hidden$siteID <- "CIK17"
Hidden$AKOATS_ID <- NULL
Hidden$UseData <- NULL
Hidden$Freq <- 96
head(Hidden, 10)

Hidden$Date = Hidden$sampleDate
Hidden <- Hidden%>% separate(col="Date", into=c("year", "month", "day"))
unique(Hidden$year)
head(Hidden, 10)
#View (Hidden)

```
Quartz Creek
```{r load data}
Quartz <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:97fe6478-7ba6-4a0b-b86f-c0074e797c2e", method = "libcurl"),
                    stringsAsFactors = FALSE)
Quartz$siteID <- "CIK22"
Quartz$AKOATS_ID <- NULL
Quartz$UseData <- NULL
Quartz$Freq <- 96
head(Quartz, 10)

Quartz$Date = Quartz$sampleDate
Quartz <- Quartz%>% separate(col="Date", into=c("year", "month", "day"))
unique(Quartz$year)
head(Quartz, 10)
#View (Quartz)

```

Slikok Creek
```{r load data}
Slikok <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:4f0b794e-3bea-41bb-a775-0be3018f4f10", method = "libcurl"),
                    stringsAsFactors = FALSE)
Slikok$siteID <- "CIK12"
Slikok$AKOATS_ID <- NULL
Slikok$UseData <- NULL
Slikok$Freq <- 96
head(Slikok, 10)

Slikok$Date = Slikok$sampleDate
Slikok <- Slikok%>% separate(col="Date", into=c("year", "month", "day"))
unique(Slikok$year)
head(Slikok, 10)
#View (Slikok)

```
Soldotna Creek
```{r load data}
Soldotna <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:f957c896-df79-46cb-95f4-cb700e8f5188", method = "libcurl"),
                    stringsAsFactors = FALSE)
Soldotna$siteID <- "CIK11"
Soldotna$AKOATS_ID <- NULL
Soldotna$UseData <- NULL
Soldotna$Freq <- 96
head(Soldotna, 10)

Soldotna$Date = Soldotna$sampleDate
Soldotna <- Soldotna%>% separate(col="Date", into=c("year", "month", "day"))
unique(Soldotna$year)
head(Soldotna, 10)
#View (Soldotna)

```
Beaver Creek
```{r load data}
Beaver <- read.csv(url("https://cn.dataone.org/cn/v2/resolve/urn:uuid:bb1415cc-e704-4ae5-aebe-3d23bc675d7e", method = "libcurl"),
                    stringsAsFactors = FALSE)
Beaver$siteID <- "CIK10"
Beaver$AKOATS_ID <- NULL
Beaver$UseData <- NULL
Beaver$Freq <- 96
head(Beaver, 10)

Beaver$Date = Beaver$sampleDate
Beaver <- Beaver%>% separate(col="Date", into=c("year", "month", "day"))
unique(Beaver$year)
head(Beaver, 10)
#View (Beaver)

```

Files sent by Sue in email
```{r}
Moose_2014 <- read.csv(file="C:/Temperature_Database/Data/Kenai/CIK/CIK5_2014.csv", header=TRUE, sep=",")
Moose_2015 <- read.csv(file="C:/Temperature_Database/Data/Kenai/CIK/CIK5_2015.csv", header=TRUE, sep=",")
Moose <- rbind(Moose_2014, Moose_2015)
Moose$siteID <- "CIK5"

Moose$Freq <- 96
Moose$Date = Moose$sampleDate
Moose <- Moose%>% separate(col="Date", into=c("year", "month", "day"))

unique(Moose$year)
head(Moose, 10)
#View (Moose)
```
#Ben Meyers Data for Beaver Creek - Lower, Middle, and Upper sites
LBC
```{r}
LBC <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM1_2016.csv", header=TRUE, sep=",")
LBC$siteID <- "BM1"
LBC$Freq <- 96
LBC$Date = LBC$sampleDate
LBC <- LBC%>% separate(col="Date", into=c("year", "month", "day"))
unique(LBC$year)
head(LBC, 10)
```
MBC
```{r}
MBC <- read.csv(file="C://Temperature_Database/Data/Kenai/Meyers/BM2_2016.csv", header=TRUE, sep=",")
MBC$siteID <- "BM2"
MBC$Freq <- 96
MBC$Date = MBC$sampleDate
MBC <- MBC%>% separate(col="Date", into=c("year", "month", "day"))
unique(MBC$year)
head(MBC, 10)
```
UBC
```{r}
UBC <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM3_2016.csv", header=TRUE, sep=",")
UBC$siteID <- "BM3"
UBC$Freq <- 96
UBC$Date = UBC$sampleDate
UBC <- UBC%>% separate(col="Date", into=c("year", "month", "day"))
unique(UBC$year)
head(UBC, 10)
```
UBC1
```{r}
UBC1 <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM4_2016.csv", header=TRUE, sep=",")
UBC1$siteID <- "BM4"
UBC1$Freq <- 96
UBC1$Date = UBC1$sampleDate
UBC1 <- UBC1%>% separate(col="Date", into=c("year", "month", "day"))
unique(UBC1$year)
head(UBC1, 10)
```
UBC2
```{r}
UBC2 <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM5_2016.csv", header=TRUE, sep=",")
UBC2$siteID <- "BM5"
UBC2$Freq <- 96
UBC2$Date = UBC2$sampleDate
UBC2 <- UBC2%>% separate(col="Date", into=c("year", "month", "day"))
UBC2$X <- NULL
unique(UBC2$year)
head(UBC2, 10)
```
Merge all Ben Meyers Data
```{r}
BC_meyers <- rbind(LBC, MBC, UBC, UBC1, UBC2)
```

#Ben Meyers Data for Ptarmigan Creek - Lower, Middle, and Upper sites plus Lower Ptarmigan site from Kenai watershed (2016) forum which received from Ben in his excel file
LPC
```{r}
LPC <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM6_2016.csv", header=TRUE, sep=",")
LPC$siteID <- "BM6"
LPC$Freq <- 96
LPC$Date = LPC$sampleDate
LPC <- LPC%>% separate(col="Date", into=c("year", "month", "day"))
unique(LPC$year)
head(LPC, 10)
```


```{r}
LPC_KWF <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/KWF4_2016.csv", header=TRUE, sep=",")
LPC_KWF$siteID <- "KWF4"
LPC_KWF$Freq <- 96
LPC_KWF$Date = LPC_KWF$sampleDate
LPC_KWF <- LPC_KWF%>% separate(col="Date", into=c("year", "month", "day"))
#unique(LPC_KWF$year)
head(LPC_KWF, 10)

MPC <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM7_2016.csv", header=TRUE, sep=",")
MPC$siteID <- "BM7"
MPC$Freq <- 96
MPC$Date = MPC$sampleDate
MPC <- MPC%>% separate(col="Date", into=c("year", "month", "day"))
#unique(MPC$year)
head(MPC, 10)

UPC <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM8_2016.csv", header=TRUE, sep=",")
UPC$siteID <- "BM8"
UPC$Freq <- 96
UPC$Date = UPC$sampleDate
UPC <- UPC%>% separate(col="Date", into=c("year", "month", "day"))
#unique(UPC$year)
head(UPC, 10)

PC_meyers <- rbind(LPC, LPC_KWF, MPC, UPC)
```

#Ben Meyers Data for Russian River - Lower, Middle, and Upper sites 
```{r}
LRR <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM9_2016.csv", header=TRUE, sep=",")
LRR$siteID <- "BM9"
LRR$Freq <- 96
LRR$Date = LRR$sampleDate
LRR <- LRR%>% separate(col="Date", into=c("year", "month", "day"))
#unique(LRR$year)
head(LRR, 10)

MRR <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM10_2016.csv", header=TRUE, sep=",")
MRR$siteID <- "BM10"
MRR$Freq <- 96
MRR$Date = MRR$sampleDate
MRR <- MRR%>% separate(col="Date", into=c("year", "month", "day"))
#unique(MRR$year)
head(MRR, 10)

MRR1 <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM11_2016.csv", header=TRUE, sep=",")
MRR1$siteID <- "BM11"
MRR1$Freq <- 96
MRR1$Date = MRR1$sampleDate
MRR1 <- MRR1%>% separate(col="Date", into=c("year", "month", "day"))
#unique(MRR1$year)
head(MRR1, 10)

MRR2 <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM12_2016.csv", header=TRUE, sep=",")
MRR2$siteID <- "BM12"
MRR2$Freq <- 96
MRR2$Date = MRR2$sampleDate
MRR2 <- MRR2%>% separate(col="Date", into=c("year", "month", "day"))
#unique(MRR2$year)
head(MRR2, 10)

URR <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM13_2016.csv", header=TRUE, sep=",")
URR$siteID <- "BM13"
URR$Freq <- 96
URR$Date = URR$sampleDate
URR <- URR%>% separate(col="Date", into=c("year", "month", "day"))
#unique(URR$year)
head(URR, 10)

URR1 <- read.csv(file="C:/Temperature_Database/Data/Kenai/Meyers/BM14_2016.csv", header=TRUE, sep=",")
URR1$siteID <- "BM14"
URR1$Freq <- 96
URR1$Date = URR1$sampleDate
URR1 <- URR1%>% separate(col="Date", into=c("year", "month", "day"))
#unique(URR1$year)
head(URR1, 10)

RR_meyers <- rbind(LRR, MRR, MRR1, MRR2, URR, URR1)
```

#EPSCOR - Kenai Watershed Data for Beaver, Ptarmigan, and Russian sites - 2015 only. 
```{r}
BC_KWF <- read.csv(file="C:/Temperature_Database/Data/Kenai/KenaiWatershedForum/KWF1_2015.csv", header=TRUE, sep=",")
BC_KWF$siteID <- "BC_KWF"
BC_KWF$Freq <- 96
BC_KWF$Date = BC_KWF$sampleDate
BC_KWF <- BC_KWF%>% separate(col="Date", into=c("year", "month", "day"))
#unique(BC_KWF$year)
head(BC_KWF, 10)

PC_KWF <- read.csv(file="C:/Temperature_Database/Data/Kenai/KenaiWatershedForum/KWF2_2015.csv", header=TRUE, sep=",")
PC_KWF$siteID <- "PC_KWF"
PC_KWF$Freq <- 96
PC_KWF$Date = PC_KWF$sampleDate
PC_KWF <- PC_KWF%>% separate(col="Date", into=c("year", "month", "day"))
#unique(PC_KWF$year)
head(PC_KWF, 10)

RR_KWF <- read.csv(file="C:/Temperature_Database/Data/Kenai/KenaiWatershedForum/KWF3_3015.csv", header=TRUE, sep=",")
RR_KWF$siteID <- "RR_KWF"
RR_KWF$Freq <- 96
RR_KWF$Date = RR_KWF$sampleDate
RR_KWF <- RR_KWF%>% separate(col="Date", into=c("year", "month", "day"))
#unique(RR_KWF$year)
head(RR_KWF, 10)

KWF <- rbind(BC_KWF, PC_KWF, RR_KWF)
```

#Merge all datasets together except for USGS data which is daily summaries
```{r}
Kenai <- rbind(KWF,RR_meyers, PC_meyers, BC_meyers, Moose, Beaver, Slikok, Soldotna, Quartz, Funny, Hidden)
head(Kenai, 10)
```

#Calculate daily mean, min, and max metrics
```{r}
Kenai2 <- Kenai %>% filter(month=="05" | month=="06"|month=="07" | month=="08" | month=="09")
Daily <- Kenai2 %>% group_by(siteID,sampleDate, year, month, day) %>% summarize(meanT=mean(Temperature), minT=min(Temperature), maxT=max(Temperature))
View(Daily)
```


#USGS Data - already summarized to daily time step - should be merged after daily summarizes are made to other data. Filter data on flag = 'Approved'. 

```{r}
KR_USGS <- read.csv(file="C:/Temperature_Database/Data/Kenai/USGS/USGS1.csv", header=TRUE, sep=",")
KR_USGS$siteID <- "USGS1"
KR_USGS$Date = KR_USGS$sampleDate
KR_USGS <- KR_USGS%>% separate(col="Date", into=c("year", "month", "day"))
#unique(KR_USGS$year)
unique(KR_USGS$mean_temp_flag)
count(KR_USGS)
KR_USGS2 <- subset(KR_USGS, mean_temp_flag=="A")
unique(KR_USGS2$mean_temp_flag)
count(KR_USGS2)
head(KR_USGS2, 10)

KR1_USGS <- read.csv(file="C:/Temperature_Database/Data/Kenai/USGS/USGS3.csv", header=TRUE, sep=",")
KR1_USGS$siteID <- "USGS3"
KR1_USGS$Date = KR1_USGS$sampleDate
KR1_USGS <- KR1_USGS%>% separate(col="Date", into=c("year", "month", "day"))
#unique(KR1_USGS$year)
unique(KR1_USGS$mean_temp_flag)
count(KR1_USGS)
KR1_USGS2 <- subset(KR1_USGS, mean_temp_flag=="A")
unique(KR1_USGS2$mean_temp_flag)
count(KR1_USGS2)
head(KR1_USGS2, 10)

KR2_USGS <- read.csv(file="C:/Temperature_Database/Data/USGS/USGS4.csv", header=TRUE, sep=",")
KR2_USGS$siteID <- "USGS4"
KR2_USGS$Date = KR2_USGS$sampleDate
KR2_USGS <- KR2_USGS%>% separate(col="Date", into=c("year", "month", "day"))
#unique(KR2_USGS$year)
unique(KR2_USGS$mean_temp_flag)
count(KR2_USGS)
KR2_USGS2 <- subset(KR2_USGS, mean_temp_flag=="A")
unique(KR2_USGS2$mean_temp_flag)
count(KR2_USGS2)
head(KR2_USGS2, 10)

CC_USGS <- read.csv(file="C:/Temperature_Database/Data/Kenai/USGS/USGS2.csv", header=TRUE, sep=",")
CC_USGS$siteID <- "USGS2"
CC_USGS$Date = CC_USGS$sampleDate
CC_USGS <- CC_USGS%>% separate(col="Date", into=c("year", "month", "day"))
#unique(CC_USGS$year)
unique(CC_USGS$mean_temp_flag)
count(CC_USGS)
CC_USGS2 <- subset(CC_USGS, mean_temp_flag=="A")
unique(CC_USGS2$mean_temp_flag)
count(CC_USGS2)
head(CC_USGS2, 10)

USGS <- rbind(KR_USGS2, KR1_USGS2, KR2_USGS2, CC_USGS2)
USGS$meanT <- USGS$mean_temp
USGS$minT <- USGS$min_temp
USGS$maxT <- USGS$max_temp
USGS$mean_temp <- NULL
USGS$mean_temp_flag <- NULL
USGS$min_temp <- NULL
USGS$min_temp_flag <- NULL
USGS$max_temp <- NULL
USGS$max_temp_flag <- NULL
USGS3 <- USGS[, c(2,1,3,4,5,6,7,8)]
USGS4 <- USGS3 %>% filter(month=="05"| month=="06"|month=="07" | month=="08" | month=="09")
head(USGS4, 10)
View(USGS4)
glimpse(USGS4)

```

# Merge USGS daily data with 15 minute interval data.
```{r}
KenaiTemp <- rbind.data.frame(USGS4, Daily)
View(KenaiTemp)
head(KenaiTemp, 10)
unique(KenaiTemp$year)
obs <- KenaiTemp %>% group_by(year, month) %>% count(siteID)

#write to csv
#write.csv(KenaiTemp, "C:/KFHP/Data/STemp/Kenai/KenaiTemp.csv")
```

